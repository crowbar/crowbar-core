<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Cookbook: identity
  
    &mdash; Documentation by YARD 0.8.7
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../';
  framesUrl = "../frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (i)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../chef.html" title="chef (chef)">chef</a></span></span>
     &raquo; 
    <span class="title">identity</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="cookbooks_list_link"
        href="../cookbooks_list.html">
      Cookbook List
    </a>
  
    <a class="full_list_link" id="recipes_list_link"
        href="../recipes_list.html">
      Recipe List
    </a>
  
    <a class="full_list_link" id="resources_list_link"
        href="../resources_list.html">
      Resource List
    </a>
  
    <a class="full_list_link" id="definitions_list_link"
        href="../definitions_list.html">
      Definitions List
    </a>
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">
      Libraries List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content">

<div id="filecontents">
  <h1>Cookbook : identity</h1>
  

<h1>Description</h1>

<p>This cookbook installs the OpenStack Identity Service <strong>Keystone</strong> as part of the OpenStack reference deployment Chef for OpenStack. The <a href="http://github.com/mattray/chef-openstack-repo">http://github.com/mattray/chef-openstack-repo</a> contains documentation for using this cookbook in the context of a full OpenStack deployment. Keystone is installed from packages, creating the default user, tenant, and roles. It also registers the identity service and identity endpoint.</p>

<p><a href="http://keystone.openstack.org/">http://keystone.openstack.org/</a></p>

<h1>Requirements</h1>

<p>Chef 0.10.0 or higher required (for Chef environment use)</p>

<h2>Cookbooks</h2>

<p>The following cookbooks are dependencies:</p>

<ul>
<li>openstack-common</li>
</ul>

<h1>Usage</h1>

<h2>server</h2>

<p>Installs and Configures Keystone Service</p>

<pre class="code json"><code class="json">&quot;run_list&quot;: [
    &quot;recipe[openstack-identity::server]&quot;
]
</code></pre>

<h1>Resources/Providers</h1>

<p>These resources provide an abstraction layer for interacting with the keystone server&#39;s API, allowing for other nodes to register any required users, tenants, roles, services, or endpoints.</p>

<h2>register</h2>

<p>Register users, tenants, roles, services and endpoints with Keystone</p>

<h3>Actions</h3>

<ul>
<li>:create_tenant: Create a tenant</li>
<li>:create_user: Create a user for a specified tenant</li>
<li>:create_role: Create a role</li>
<li>:grant_role: Grant a role to a specified user for a specified tenant</li>
<li>:create_service: Create a service</li>
<li>:create_endpoint: Create an endpoint for a sepcified service</li>
</ul>

<h3>General Attributes</h3>

<ul>
<li>auth_protocol: Required communication protocol with Keystone server

<ul>
<li>Acceptable values are [ &quot;http&quot;, &quot;https&quot; ]</li>
</ul></li>
<li>auth_host: Keystone server IP Address</li>
<li>auth_port: Port Keystone server is listening on</li>
<li>api_ver: API Version for Keystone server

<ul>
<li>Accepted values are [ &quot;/v2.0&quot; ]</li>
</ul></li>
<li>auth_token: Auth Token for communication with Keystone server</li>
</ul>

<h3>:create_tenant Specific Attributes</h3>

<ul>
<li>tenant_name: Name of tenant to create</li>
<li>tenant_description: Description of tenant to create</li>
<li>tenant_enabled: Enable or Disable tenant

<ul>
<li>Accepted values are [ &quot;true&quot;, &quot;false&quot; ]</li>
<li>Default is &quot;true&quot;</li>
</ul></li>
</ul>

<h3>:create_user Specific Attributes</h3>

<ul>
<li>user_name: Name of user account to create</li>
<li>user_pass: Password for the user account</li>
<li>user_enabled: Enable or Disable user

<ul>
<li>Accepted values are [ &quot;true&quot;, &quot;false&quot; ]</li>
<li>Default is &quot;true&quot;</li>
</ul></li>
<li>tenant_name: Name of tenant to create user in</li>
</ul>

<h3>:create_role Specific Attributes</h3>

<ul>
<li>role_name: Name of the role to create</li>
</ul>

<h3>:grant_role Specific Attributes</h3>

<ul>
<li>role_name: Name of the role to grant</li>
<li>user_name: User name to grant the role to</li>
<li>tenant_name: Name of tenant to grant role in</li>
</ul>

<h3>:create_service Specific Attributes</h3>

<ul>
<li>service_name: Name of service</li>
<li>service_description: Description of service</li>
<li>service_type: Type of service to create

<ul>
<li>Accepted values are [ &quot;image&quot;, &quot;identity&quot;, &quot;compute&quot;, &quot;storage&quot;, &quot;ec2&quot;, &quot;volume&quot; ]</li>
</ul></li>
</ul>

<h3>:create_endpoint Specific Attributes</h3>

<ul>
<li>endpoint_region: Default value is &quot;RegionOne&quot;</li>
<li>endpoint_adminurl: URL to admin endpoint (using admin port)</li>
<li>endpoint_internalurl: URL to service endpoint (using service port)</li>
<li>endpoint_publicurl: URL to public endpoint

<ul>
<li>Default is same as endpoint_internalURL</li>
</ul></li>
<li>service_type: Type of service to create endpoint for

<ul>
<li>Accepted values are [ &quot;image&quot;, &quot;identity&quot;, &quot;compute&quot;, &quot;storage&quot;, &quot;ec2&quot;, &quot;volume&quot; ]</li>
</ul></li>
</ul>

<h3>Examples</h3>

<pre class="code ruby"><code class="ruby"><span class='comment'># Create 'openstack' tenant
</span><span class='id identifier rubyid_openstack_identity_register'>openstack_identity_register</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Register 'openstack' Tenant</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_auth_host'>auth_host</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>192.168.1.10</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_auth_port'>auth_port</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>35357</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_auth_protocol'>auth_protocol</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>http</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_api_ver'>api_ver</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/v2.0</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_auth_token'>auth_token</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>123456789876</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_tenant_name'>tenant_name</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>openstack</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_tenant_description'>tenant_description</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Default Tenant</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_tenant_enabled'>tenant_enabled</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>true</span><span class='tstring_end'>&quot;</span></span> <span class='comment'># Not required as this is the default
</span>  <span class='id identifier rubyid_action'>action</span> <span class='symbol'>:create_tenant</span>
<span class='kw'>end</span>

<span class='comment'># Create 'admin' user
</span><span class='id identifier rubyid_openstack_identity_register'>openstack_identity_register</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Register 'admin' User</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_auth_host'>auth_host</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>192.168.1.10</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_auth_port'>auth_port</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>35357</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_auth_protocol'>auth_protocol</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>http</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_api_ver'>api_ver</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/v2.0</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_auth_token'>auth_token</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>123456789876</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_tenant_name'>tenant_name</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>openstack</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_user_name'>user_name</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>admin</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_user_pass'>user_pass</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>secrete</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_user_enabled'>user_enabled</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>true</span><span class='tstring_end'>&quot;</span></span> <span class='comment'># Not required as this is the default
</span>  <span class='id identifier rubyid_action'>action</span> <span class='symbol'>:create_user</span>
<span class='kw'>end</span>

<span class='comment'># Create 'admin' role
</span><span class='id identifier rubyid_openstack_identity_register'>openstack_identity_register</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Register 'admin' Role</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_auth_host'>auth_host</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>192.168.1.10</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_auth_port'>auth_port</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>35357</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_auth_protocol'>auth_protocol</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>http</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_api_ver'>api_ver</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/v2.0</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_auth_token'>auth_token</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>123456789876</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_role_name'>role_name</span> <span class='id identifier rubyid_role_key'>role_key</span>
  <span class='id identifier rubyid_action'>action</span> <span class='symbol'>:create_role</span>
<span class='kw'>end</span>


<span class='comment'># Grant 'admin' role to 'admin' user in the 'openstack' tenant
</span><span class='id identifier rubyid_openstack_identity_register'>openstack_identity_register</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Grant 'admin' Role to 'admin' User</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_auth_host'>auth_host</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>192.168.1.10</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_auth_port'>auth_port</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>35357</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_auth_protocol'>auth_protocol</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>http</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_api_ver'>api_ver</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/v2.0</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_auth_token'>auth_token</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>123456789876</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_tenant_name'>tenant_name</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>openstack</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_user_name'>user_name</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>admin</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_role_name'>role_name</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>admin</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_action'>action</span> <span class='symbol'>:grant_role</span>
<span class='kw'>end</span>

<span class='comment'># Create 'identity' service
</span><span class='id identifier rubyid_openstack_identity_register'>openstack_identity_register</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Register Identity Service</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_auth_host'>auth_host</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>192.168.1.10</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_auth_port'>auth_port</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>35357</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_auth_protocol'>auth_protocol</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>http</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_api_ver'>api_ver</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/v2.0</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_auth_token'>auth_token</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>123456789876</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_service_name'>service_name</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>keystone</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_service_type'>service_type</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>identity</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_service_description'>service_description</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Keystone Identity Service</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_action'>action</span> <span class='symbol'>:create_service</span>
<span class='kw'>end</span>

<span class='comment'># Create 'identity' endpoint
</span><span class='id identifier rubyid_openstack_identity_register'>openstack_identity_register</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Register Identity Endpoint</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_auth_host'>auth_host</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>192.168.1.10</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_auth_port'>auth_port</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>35357</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_auth_protocol'>auth_protocol</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>http</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_api_ver'>api_ver</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/v2.0</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_auth_token'>auth_token</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>123456789876</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_service_type'>service_type</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>identity</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_endpoint_region'>endpoint_region</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>RegionOne</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_endpoint_adminurl'>endpoint_adminurl</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>http://192.168.1.10:35357/v2.0</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_endpoint_internalurl'>endpoint_internalurl</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>http://192.168.1.10:5001/v2.0</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_endpoint_publicurl'>endpoint_publicurl</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>http://1.2.3.4:5001/v2.0</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_action'>action</span> <span class='symbol'>:create_endpoint</span>
<span class='kw'>end</span>
</code></pre>

<h2>credentials</h2>

<p>Create EC2 credentials for a given user in the specified tenant</p>

<h3>Actions</h3>

<ul>
<li>:create_ec2: create EC2 credentials</li>
</ul>

<h3>General Attributes</h3>

<ul>
<li>auth_protocol: Required communication protocol with Keystone server. Acceptable values are [ &quot;http&quot;, &quot;https&quot; ]</li>
<li>auth_host: Keystone server IP Address</li>
<li>auth_port: Port Keystone server is listening on</li>
<li>api_ver: API Version for Keystone server

<ul>
<li>Accepted values are [ &quot;/v2.0&quot; ]</li>
</ul></li>
<li>auth_token: Auth Token for communication with Keystone server</li>
</ul>

<h3>:create_ec2 Specific Attributes</h3>

<ul>
<li>user_name: User name to grant the credentials for</li>
<li>tenant_name: Tenant name to grant the credentials in</li>
</ul>

<h3>Examples</h3>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_openstack_identity_credentials'>openstack_identity_credentials</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Create EC2 credentials for 'admin' user</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_auth_host'>auth_host</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>192.168.1.10</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_auth_port'>auth_port</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>35357</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_auth_protocol'>auth_protocol</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>http</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_api_ver'>api_ver</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/v2.0</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_auth_token'>auth_token</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>123456789876</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_user_name'>user_name</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>admin</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_tenant_name'>tenant_name</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>openstack</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
</code></pre>

<h1>Attributes</h1>

<ul>
<li><code>openstack[&#39;identity&#39;][&#39;db_server_chef_role&#39;]</code> - The name of the Chef role that knows about the db server</li>
<li><code>openstack[&#39;identity&#39;][&#39;bind_interface&#39;]</code> - Interface to bind keystone to</li>
<li><code>openstack[&#39;identity&#39;][&#39;service_port&#39;]</code> - Port to listen on for client functions</li>
<li><code>openstack[&#39;identity&#39;][&#39;admin_port&#39;]</code> - Port to listen on for admin functions</li>
<li><code>openstack[&#39;identity&#39;][&#39;user&#39;]</code> - User keystone runs as</li>
<li><code>openstack[&#39;identity&#39;][&#39;group&#39;]</code> - Group keystone runs as</li>
<li><code>openstack[&#39;identity&#39;][&#39;db&#39;]</code> - Name of keystone database</li>
<li><code>openstack[&#39;identity&#39;][&#39;db_user&#39;]</code> - Username for keystone database access</li>
<li><code>openstack[&#39;identity&#39;][&#39;db_passwd&#39;]</code> - Password for keystone database access</li>
<li><code>openstack[&#39;identity&#39;][&#39;db_ipaddress&#39;]</code> - IP address of the keystone database</li>
<li><code>openstack[&#39;identity&#39;][&#39;api_ipaddress&#39;]</code> - IP address for the keystone API to bind to. <em>TODO</em>: Rename to bind_address</li>
<li><code>openstack[&#39;identity&#39;][&#39;verbose&#39;]</code> - Enables/disables verbose output for keystone API server</li>
<li><code>openstack[&#39;identity&#39;][&#39;debug&#39;]</code> - Enables/disables debug output for keystone API server</li>
<li><code>openstack[&#39;identity&#39;][&#39;service_port&#39;]</code> - Port for the keystone service API to bind to</li>
<li><code>openstack[&#39;identity&#39;][&#39;admin_port&#39;]</code> - Port for the keystone admin service to bind to</li>
<li><code>openstack[&#39;identity&#39;][&#39;admin_token&#39;]</code> - Admin token for bootstraping keystone server</li>
<li><code>openstack[&#39;identity&#39;][&#39;roles&#39;]</code> - Array of roles to create in the keystone server</li>
<li><code>openstack[&#39;identity&#39;][&#39;users&#39;]</code> - Array of users to create in the keystone server</li>
</ul>

<h1>Testing</h1>

<p>This cookbook uses <a href="http://gembundler.com/">bundler</a>, <a href="http://berkshelf.com/">berkshelf</a>, and <a href="https://github.com/customink/strainer">strainer</a> to isolate dependencies and run tests.</p>

<p>Tests are defined in Strainerfile.</p>

<p>To run tests:</p>

<pre class="code ruby"><code class="ruby">$ bundle install # install gem dependencies
$ bundle exec berks install # install cookbook dependencies
$ bundle exec strainer test # run tests
</code></pre>

<h1>License and Author</h1>

<p>Author:: Justin Shepherd (<a href="mailto:justin.shepherd@rackspace.com">justin.shepherd@rackspace.com</a>)
Author:: Jason Cannavale (<a href="mailto:jason.cannavale@rackspace.com">jason.cannavale@rackspace.com</a>)
Author:: Ron Pedde (<a href="mailto:ron.pedde@rackspace.com">ron.pedde@rackspace.com</a>)
Author:: Joseph Breu (<a href="mailto:joseph.breu@rackspace.com">joseph.breu@rackspace.com</a>)
Author:: William Kelly (<a href="mailto:william.kelly@rackspace.com">william.kelly@rackspace.com</a>)
Author:: Darren Birkett (<a href="mailto:darren.birkett@rackspace.co.uk">darren.birkett@rackspace.co.uk</a>)
Author:: Evan Callicoat (<a href="mailto:evan.callicoat@rackspace.com">evan.callicoat@rackspace.com</a>)
Author:: Matt Ray (<a href="mailto:matt@opscode.com">matt@opscode.com</a>)
Author:: Jay Pipes (<a href="mailto:jaypipes@att.com">jaypipes@att.com</a>)
Author:: John Dewey (<a href="mailto:jdewey@att.com">jdewey@att.com</a>)
Author:: Sean Gallagher (<a href="mailto:sean.gallagher@att.com">sean.gallagher@att.com</a>)
Author:: Ionut Artarisi (<a href="mailto:iartarisi@suse.cz">iartarisi@suse.cz</a>)</p>

<p>Copyright 2012, Rackspace US, Inc.
Copyright 2012-2013, Opscode, Inc.
Copyright 2012-2013, AT&amp;T Services, Inc.
Copyright 2013, SUSE Linux GmbH</p>

<p>Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
you may not use this file except in compliance with the License.
You may obtain a copy of the License at</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_http'>http</span><span class='symbol'>:/</span><span class='op'>/</span><span class='id identifier rubyid_www'>www</span><span class='period'>.</span><span class='id identifier rubyid_apache'>apache</span><span class='period'>.</span><span class='id identifier rubyid_org'>org</span><span class='op'>/</span><span class='id identifier rubyid_licenses'>licenses</span><span class='op'>/</span><span class='const'>LICENSE</span><span class='op'>-</span><span class='float'>2.0</span>
</code></pre>

<p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.</p>



<h1>Cookbook Documentation</h1>




  <h2>Recipes Summary</h2>
  <ul class="summary">
    
      <li>
        <span class="summary_signature">
          <strong><a href="#identity::server">identity::server</a></strong>
        </span>
        <span class="summary_desc">Installs and Configures Keystone Service</span>
      </li>
    
      <li>
        <span class="summary_signature">
          <strong><a href="#identity::default">identity::default</a></strong>
        </span>
        <span class="summary_desc"></span>
      </li>
    
      <li>
        <span class="summary_signature">
          <strong><a href="#identity::registration">identity::registration</a></strong>
        </span>
        <span class="summary_desc">Adds user, tenant, role and endpoint records to Keystone</span>
      </li>
    
  </ul>




  <h2>Lightweight Resources</h2>
  
    <h3><a name="Chef::Resource::IdentityRegister">identity_register</a></h3>
    <ul>


  <h4>Actions</h4>
  
  <ul><table>
    <thead>
      <th>Action</th>
      <th>Description</th>
    </thead>
    <tbody>
      
        <tr class="r1">
          <td><strong>create_service</strong></td>
          <td></td>
        </tr>
        
      
    </tbody>
  </table></ul>




  <h4>Attributes</h4>
  <ul>


<table>
  <thead>
    <th>Attribute</th>
    <th>Description</th>
  </thead>
  <tbody>
    
      <tr class="r1">
        <td><strong>auth_uri</strong></td>
        <td></td>
      </tr>
      
    
      <tr class="r2">
        <td><strong>bootstrap_token</strong></td>
        <td></td>
      </tr>
      
    
      <tr class="r1">
        <td><strong>service_type</strong></td>
        <td>Used by both :create_service and :create_endpoint</td>
      </tr>
      
    
      <tr class="r2">
        <td><strong>service_name</strong></td>
        <td>:create_service specific attributes</td>
      </tr>
      
    
      <tr class="r1">
        <td><strong>service_description</strong></td>
        <td></td>
      </tr>
      
    
      <tr class="r2">
        <td><strong>endpoint_region</strong></td>
        <td>:create_endpoint specific attributes</td>
      </tr>
      
    
      <tr class="r1">
        <td><strong>endpoint_adminurl</strong></td>
        <td></td>
      </tr>
      
    
      <tr class="r2">
        <td><strong>endpoint_internalurl</strong></td>
        <td></td>
      </tr>
      
    
      <tr class="r1">
        <td><strong>endpoint_publicurl</strong></td>
        <td></td>
      </tr>
      
    
      <tr class="r2">
        <td><strong>tenant_name</strong></td>
        <td>Used by both :create_tenant and :create_user</td>
      </tr>
      
    
      <tr class="r1">
        <td><strong>tenant_description</strong></td>
        <td>:create_tenant specific attributes</td>
      </tr>
      
    
      <tr class="r2">
        <td><strong>tenant_enabled</strong></td>
        <td></td>
      </tr>
      
    
      <tr class="r1">
        <td><strong>user_name</strong></td>
        <td>:create_user specific attributes</td>
      </tr>
      
    
      <tr class="r2">
        <td><strong>user_pass</strong></td>
        <td></td>
      </tr>
      
    
      <tr class="r1">
        <td><strong>user_enabled</strong></td>
        <td>attribute :user_email, :kind_of => String</td>
      </tr>
      
    
      <tr class="r2">
        <td><strong>role_name</strong></td>
        <td>Used by :create_role and :grant_role specific attributes</td>
      </tr>
      
    
  </tbody>
</table>
</ul>




</ul>
  




  <h2>Providers</h2>
  
    <h3><a name="Chef::Provider::IdentityRegister">identity_register</a></h3>
    <ul>


  <h4>Actions Summary</h4>
  <ul class="summary">
    
      <li>
        <span class="summary_signature">
          <strong><a href="#create_service">create_service</a></strong>
        </span>
        <span class="summary_desc"></span>
      </li>
    
      <li>
        <span class="summary_signature">
          <strong><a href="#create_endpoint">create_endpoint</a></strong>
        </span>
        <span class="summary_desc"></span>
      </li>
    
      <li>
        <span class="summary_signature">
          <strong><a href="#create_tenant">create_tenant</a></strong>
        </span>
        <span class="summary_desc"></span>
      </li>
    
      <li>
        <span class="summary_signature">
          <strong><a href="#create_role">create_role</a></strong>
        </span>
        <span class="summary_desc"></span>
      </li>
    
      <li>
        <span class="summary_signature">
          <strong><a href="#create_user">create_user</a></strong>
        </span>
        <span class="summary_desc"></span>
      </li>
    
      <li>
        <span class="summary_signature">
          <strong><a href="#grant_role">grant_role</a></strong>
        </span>
        <span class="summary_desc"></span>
      </li>
    
      <li>
        <span class="summary_signature">
          <strong><a href="#create_ec2_credentials">create_ec2_credentials</a></strong>
        </span>
        <span class="summary_desc"></span>
      </li>
    
  </ul>

</ul>
  














<div class="method_details_list">
  



  <h2>Recipe Details</h2>
  
    <div class="method_details first">
      <h3 class="signature"><a name="identity::server">
        <strong>identity::server</strong>
      </a></h3>
      
<p>Installs and Configures Keystone Service</p>

      

<table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'recipes/server.rb', line 1</span>

<span class='comment'>#
</span><span class='comment'># Cookbook Name:: openstack-identity
</span><span class='comment'># Recipe:: server
</span><span class='comment'>#
</span><span class='comment'># Copyright 2012, Rackspace US, Inc.
</span><span class='comment'># Copyright 2012-2013, Opscode, Inc.
</span><span class='comment'>#
</span><span class='comment'># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
</span><span class='comment'># you may not use this file except in compliance with the License.
</span><span class='comment'># You may obtain a copy of the License at
</span><span class='comment'>#
</span><span class='comment'>#     http://www.apache.org/licenses/LICENSE-2.0
</span><span class='comment'>#
</span><span class='comment'># Unless required by applicable law or agreed to in writing, software
</span><span class='comment'># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
</span><span class='comment'># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
</span><span class='comment'># See the License for the specific language governing permissions and
</span><span class='comment'># limitations under the License.
</span><span class='comment'>#
</span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>uri</span><span class='tstring_end'>&quot;</span></span>

<span class='kw'>class</span> <span class='op'>::</span><span class='const'>Chef</span><span class='op'>::</span><span class='const'>Recipe</span>
  <span class='id identifier rubyid_include'>include</span> <span class='op'>::</span><span class='const'>Openstack</span>
<span class='kw'>end</span>

<span class='kw'>if</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>openstack</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>identity</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>syslog</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>use</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_include_recipe'>include_recipe</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>openstack-common::logging</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>

<span class='id identifier rubyid_platform_options'>platform_options</span> <span class='op'>=</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>openstack</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>identity</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>platform</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>

<span class='comment'>##### NOTE #####
</span><span class='comment'># https://bugs.launchpad.net/ubuntu/+source/keystone/+bug/931236
</span><span class='comment'>################
</span>
<span class='id identifier rubyid_db_type'>db_type</span> <span class='op'>=</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>openstack</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>db</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>identity</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>db_type</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
<span class='id identifier rubyid_platform_options'>platform_options</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_db_type'>db_type</span><span class='rbrace'>}</span><span class='tstring_content'>_python_packages</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_pkg'>pkg</span><span class='op'>|</span>
  <span class='id identifier rubyid_package'>package</span> <span class='id identifier rubyid_pkg'>pkg</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_action'>action</span> <span class='symbol'>:install</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_platform_options'>platform_options</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>memcache_python_packages</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_pkg'>pkg</span><span class='op'>|</span>
  <span class='id identifier rubyid_package'>package</span> <span class='id identifier rubyid_pkg'>pkg</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_action'>action</span> <span class='symbol'>:install</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_platform_options'>platform_options</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>keystone_packages</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_pkg'>pkg</span><span class='op'>|</span>
  <span class='id identifier rubyid_package'>package</span> <span class='id identifier rubyid_pkg'>pkg</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_options'>options</span> <span class='id identifier rubyid_platform_options'>platform_options</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>package_options</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>

    <span class='id identifier rubyid_action'>action</span> <span class='symbol'>:upgrade</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_execute'>execute</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Keystone: sleep</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_command'>command</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sleep 10s</span><span class='tstring_end'>&quot;</span></span>

  <span class='id identifier rubyid_action'>action</span> <span class='symbol'>:nothing</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_service'>service</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>keystone</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_service_name'>service_name</span> <span class='id identifier rubyid_platform_options'>platform_options</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>keystone_service</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_supports'>supports</span> <span class='symbol'>:status</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='symbol'>:restart</span> <span class='op'>=&gt;</span> <span class='kw'>true</span>

  <span class='id identifier rubyid_action'>action</span> <span class='lbracket'>[</span> <span class='symbol'>:enable</span> <span class='rbracket'>]</span>

  <span class='id identifier rubyid_notifies'>notifies</span> <span class='symbol'>:run</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>execute[Keystone: sleep]</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:immediately</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_directory'>directory</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/etc/keystone</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_owner'>owner</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>openstack</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>identity</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_group'>group</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>openstack</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>identity</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>group</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_mode'>mode</span>  <span class='int'>00700</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_directory'>directory</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>openstack</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>identity</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>signing</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>basedir</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_owner'>owner</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>openstack</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>identity</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_group'>group</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>openstack</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>identity</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>group</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_mode'>mode</span>  <span class='int'>00700</span>

  <span class='id identifier rubyid_only_if'>only_if</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>openstack</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>auth</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>strategy</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pki</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_file'>file</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/var/lib/keystone/keystone.db</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_action'>action</span> <span class='symbol'>:delete</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_execute'>execute</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>keystone-manage pki_setup</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_user'>user</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>openstack</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>identity</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>

  <span class='id identifier rubyid_only_if'>only_if</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>openstack</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>auth</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>strategy</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pki</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_not_if'>not_if</span> <span class='lbrace'>{</span> <span class='op'>::</span><span class='const'>FileTest</span><span class='period'>.</span><span class='id identifier rubyid_exists?'>exists?</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>openstack</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>identity</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>signing</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>keyfile</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_identity_admin_endpoint'>identity_admin_endpoint</span> <span class='op'>=</span> <span class='id identifier rubyid_endpoint'>endpoint</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>identity-admin</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_identity_endpoint'>identity_endpoint</span> <span class='op'>=</span> <span class='id identifier rubyid_endpoint'>endpoint</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>identity-api</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_compute_endpoint'>compute_endpoint</span> <span class='op'>=</span> <span class='id identifier rubyid_endpoint'>endpoint</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>compute-api</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_ec2_endpoint'>ec2_endpoint</span> <span class='op'>=</span> <span class='id identifier rubyid_endpoint'>endpoint</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>compute-ec2-api</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_image_endpoint'>image_endpoint</span> <span class='op'>=</span> <span class='id identifier rubyid_endpoint'>endpoint</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>image-api</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_network_endpoint'>network_endpoint</span> <span class='op'>=</span> <span class='id identifier rubyid_endpoint'>endpoint</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>network-api</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_volume_endpoint'>volume_endpoint</span> <span class='op'>=</span> <span class='id identifier rubyid_endpoint'>endpoint</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>volume-api</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_db_user'>db_user</span> <span class='op'>=</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>openstack</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>identity</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>db</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>username</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
<span class='id identifier rubyid_db_pass'>db_pass</span> <span class='op'>=</span> <span class='id identifier rubyid_db_password'>db_password</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>keystone</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_sql_connection'>sql_connection</span> <span class='op'>=</span> <span class='id identifier rubyid_db_uri'>db_uri</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>identity</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_db_user'>db_user</span><span class='comma'>,</span> <span class='id identifier rubyid_db_pass'>db_pass</span><span class='rparen'>)</span>

<span class='id identifier rubyid_bootstrap_token'>bootstrap_token</span> <span class='op'>=</span> <span class='id identifier rubyid_secret'>secret</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>secrets</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>openstack_identity_bootstrap_token</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_ip_address'>ip_address</span> <span class='op'>=</span> <span class='id identifier rubyid_address_for'>address_for</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>openstack</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>identity</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bind_interface</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>

<span class='comment'># If the search role is set, we search for memcache
</span><span class='comment'># servers via a Chef search. If not, we look at the
</span><span class='comment'># memcache.servers attribute.
</span><span class='id identifier rubyid_memcache_servers'>memcache_servers</span> <span class='op'>=</span> <span class='id identifier rubyid_memcached_servers'>memcached_servers</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>,</span><span class='tstring_end'>&quot;</span></span>  <span class='comment'># from openstack-common lib
</span>
<span class='id identifier rubyid_uris'>uris</span> <span class='op'>=</span> <span class='lbrace'>{</span>
  <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>identity-admin</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_identity_admin_endpoint'>identity_admin_endpoint</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>%25</span><span class='tstring_end'>'</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>%</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>identity</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_identity_endpoint'>identity_endpoint</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>%25</span><span class='tstring_end'>'</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>%</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>image</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_image_endpoint'>image_endpoint</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>%25</span><span class='tstring_end'>'</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>%</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>compute</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_compute_endpoint'>compute_endpoint</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>%25</span><span class='tstring_end'>'</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>%</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>ec2</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_ec2_endpoint'>ec2_endpoint</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>%25</span><span class='tstring_end'>'</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>%</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>network</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_network_endpoint'>network_endpoint</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>%25</span><span class='tstring_end'>'</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>%</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>volume</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_volume_endpoint'>volume_endpoint</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>%25</span><span class='tstring_end'>'</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>%</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
<span class='rbrace'>}</span>

<span class='comment'># These configuration endpoints must not have the path (v2.0, etc)
</span><span class='comment'># added to them, as these values are used in returning the version
</span><span class='comment'># listing information from the root / endpoint.
</span><span class='id identifier rubyid_ie'>ie</span> <span class='op'>=</span> <span class='id identifier rubyid_identity_endpoint'>identity_endpoint</span>
<span class='id identifier rubyid_public_endpoint'>public_endpoint</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ie'>ie</span><span class='period'>.</span><span class='id identifier rubyid_scheme'>scheme</span><span class='rbrace'>}</span><span class='tstring_content'>://</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ie'>ie</span><span class='period'>.</span><span class='id identifier rubyid_host'>host</span><span class='rbrace'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ie'>ie</span><span class='period'>.</span><span class='id identifier rubyid_port'>port</span><span class='rbrace'>}</span><span class='tstring_content'>/</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_ae'>ae</span> <span class='op'>=</span> <span class='id identifier rubyid_identity_admin_endpoint'>identity_admin_endpoint</span>
<span class='id identifier rubyid_admin_endpoint'>admin_endpoint</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ae'>ae</span><span class='period'>.</span><span class='id identifier rubyid_scheme'>scheme</span><span class='rbrace'>}</span><span class='tstring_content'>://</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ae'>ae</span><span class='period'>.</span><span class='id identifier rubyid_host'>host</span><span class='rbrace'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ae'>ae</span><span class='period'>.</span><span class='id identifier rubyid_port'>port</span><span class='rbrace'>}</span><span class='tstring_content'>/</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_template'>template</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/etc/keystone/keystone.conf</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_source'>source</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>keystone.conf.erb</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_owner'>owner</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>openstack</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>identity</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_group'>group</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>openstack</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>identity</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>group</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_mode'>mode</span>   <span class='int'>00644</span>
  <span class='id identifier rubyid_variables'>variables</span><span class='lparen'>(</span>
    <span class='symbol'>:sql_connection</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_sql_connection'>sql_connection</span><span class='comma'>,</span>
    <span class='symbol'>:ip_address</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_ip_address'>ip_address</span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bootstrap_token</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_bootstrap_token'>bootstrap_token</span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>memcache_servers</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_memcache_servers'>memcache_servers</span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>uris</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_uris'>uris</span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>public_endpoint</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_public_endpoint'>public_endpoint</span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>admin_endpoint</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_admin_endpoint'>admin_endpoint</span>
  <span class='rparen'>)</span>

  <span class='id identifier rubyid_notifies'>notifies</span> <span class='symbol'>:restart</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>service[keystone]</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:immediately</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_template'>template</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/etc/keystone/default_catalog.templates</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_source'>source</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>default_catalog.templates.erb</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_owner'>owner</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>openstack</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>identity</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_group'>group</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>openstack</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>identity</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>group</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_mode'>mode</span>   <span class='int'>00644</span>
  <span class='id identifier rubyid_variables'>variables</span><span class='lparen'>(</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>uris</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_uris'>uris</span>
  <span class='rparen'>)</span>

  <span class='id identifier rubyid_notifies'>notifies</span> <span class='symbol'>:restart</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>service[keystone]</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:immediately</span>
  <span class='id identifier rubyid_only_if'>only_if</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>openstack</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>identity</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>catalog</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>backend</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>templated</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
<span class='kw'>end</span>

<span class='comment'># sync db after keystone.conf is generated
</span><span class='id identifier rubyid_execute'>execute</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>keystone-manage db_sync</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_only_if'>only_if</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>openstack</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>identity</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>db</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>migrate</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>

    </div>
  
    <div class="method_details ">
      <h3 class="signature"><a name="identity::default">
        <strong>identity::default</strong>
      </a></h3>
      
      

<table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'recipes/default.rb', line 1</span>

<span class='comment'>#
</span><span class='comment'># Cookbook Name:: openstack-identity
</span><span class='comment'># Recipe:: default
</span><span class='comment'>#
</span><span class='comment'># Copyright 2012-2013, AT&amp;T Services, Inc.
</span><span class='comment'>#
</span><span class='comment'># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
</span><span class='comment'># you may not use this file except in compliance with the License.
</span><span class='comment'># You may obtain a copy of the License at
</span><span class='comment'>#
</span><span class='comment'>#     http://www.apache.org/licenses/LICENSE-2.0
</span><span class='comment'>#
</span><span class='comment'># Unless required by applicable law or agreed to in writing, software
</span><span class='comment'># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
</span><span class='comment'># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
</span><span class='comment'># See the License for the specific language governing permissions and
</span><span class='comment'># limitations under the License.
</span><span class='comment'>#</span></pre>
    </td>
  </tr>
</table>

    </div>
  
    <div class="method_details ">
      <h3 class="signature"><a name="identity::registration">
        <strong>identity::registration</strong>
      </a></h3>
      
<p>Adds user, tenant, role and endpoint records to Keystone</p>

      

<table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'recipes/registration.rb', line 1</span>

<span class='comment'>#
</span><span class='comment'># Cookbook Name:: openstack-identity
</span><span class='comment'># Recipe:: setup
</span><span class='comment'>#
</span><span class='comment'># Copyright 2012, Rackspace US, Inc.
</span><span class='comment'># Copyright 2012-2013, Opscode, Inc.
</span><span class='comment'>#
</span><span class='comment'># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
</span><span class='comment'># you may not use this file except in compliance with the License.
</span><span class='comment'># You may obtain a copy of the License at
</span><span class='comment'>#
</span><span class='comment'>#     http://www.apache.org/licenses/LICENSE-2.0
</span><span class='comment'>#
</span><span class='comment'># Unless required by applicable law or agreed to in writing, software
</span><span class='comment'># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
</span><span class='comment'># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
</span><span class='comment'># See the License for the specific language governing permissions and
</span><span class='comment'># limitations under the License.
</span><span class='comment'>#
</span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>uri</span><span class='tstring_end'>&quot;</span></span>

<span class='kw'>class</span> <span class='op'>::</span><span class='const'>Chef</span><span class='op'>::</span><span class='const'>Recipe</span>
  <span class='id identifier rubyid_include'>include</span> <span class='op'>::</span><span class='const'>Openstack</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_identity_admin_endpoint'>identity_admin_endpoint</span> <span class='op'>=</span> <span class='id identifier rubyid_endpoint'>endpoint</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>identity-admin</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_identity_endpoint'>identity_endpoint</span> <span class='op'>=</span> <span class='id identifier rubyid_endpoint'>endpoint</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>identity-api</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_admin_tenant_name'>admin_tenant_name</span> <span class='op'>=</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>openstack</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>identity</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>admin_tenant_name</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
<span class='id identifier rubyid_admin_user'>admin_user</span> <span class='op'>=</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>openstack</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>identity</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>admin_user</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
<span class='id identifier rubyid_admin_pass'>admin_pass</span> <span class='op'>=</span> <span class='id identifier rubyid_user_password'>user_password</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>openstack</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>identity</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>admin_user</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
<span class='id identifier rubyid_auth_uri'>auth_uri</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'>URI</span><span class='period'>.</span><span class='id identifier rubyid_decode'>decode</span> <span class='id identifier rubyid_identity_admin_endpoint'>identity_admin_endpoint</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>

<span class='id identifier rubyid_bootstrap_token'>bootstrap_token</span> <span class='op'>=</span> <span class='id identifier rubyid_secret'>secret</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>secrets</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>openstack_identity_bootstrap_token</span><span class='tstring_end'>&quot;</span></span>

<span class='comment'># We need to bootstrap the keystone admin user so that calls
</span><span class='comment'># to keystone_register will succeed, since those provider calls
</span><span class='comment'># use the admin tenant/user/pass to get an admin token.
</span><span class='id identifier rubyid_bash'>bash</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bootstrap-keystone-admin</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='comment'># A shortcut bootstrap command was added to python-keystoneclient
</span>  <span class='comment'># in early Grizzly timeframe... but we need to do all the commands
</span>  <span class='comment'># here manually since the python-keystoneclient package included
</span>  <span class='comment'># in CloudArchive (for now) doesn't have it...
</span>  <span class='id identifier rubyid_insecure'>insecure</span> <span class='op'>=</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>openstack</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>auth</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>validate_certs</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> --insecure</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_base_ks_cmd'>base_ks_cmd</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>keystone</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_insecure'>insecure</span><span class='rbrace'>}</span><span class='tstring_content'> --endpoint=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_auth_uri'>auth_uri</span><span class='rbrace'>}</span><span class='tstring_content'> --token=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_bootstrap_token'>bootstrap_token</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_code'>code</span> <span class='heredoc_beg'>&lt;&lt;-EOF</span>
<span class='tstring_content'>set -x
function get_id () {
    echo `&quot;$@&quot; | grep ' id ' | awk '{print $4}'`
}
</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_base_ks_cmd'>base_ks_cmd</span><span class='rbrace'>}</span><span class='tstring_content'> tenant-list | grep </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_admin_tenant_name'>admin_tenant_name</span><span class='rbrace'>}</span><span class='tstring_content'>
if [[ $? -eq 1 ]]; then
  ADMIN_TENANT=$(get_id </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_base_ks_cmd'>base_ks_cmd</span><span class='rbrace'>}</span><span class='tstring_content'> tenant-create --name=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_admin_tenant_name'>admin_tenant_name</span><span class='rbrace'>}</span><span class='tstring_content'>)
else
  ADMIN_TENANT=$(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_base_ks_cmd'>base_ks_cmd</span><span class='rbrace'>}</span><span class='tstring_content'> tenant-list | grep </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_admin_tenant_name'>admin_tenant_name</span><span class='rbrace'>}</span><span class='tstring_content'> | awk '{print $2}')
fi
</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_base_ks_cmd'>base_ks_cmd</span><span class='rbrace'>}</span><span class='tstring_content'> role-list | grep admin
if [[ $? -eq 1 ]]; then
  ADMIN_ROLE=$(get_id </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_base_ks_cmd'>base_ks_cmd</span><span class='rbrace'>}</span><span class='tstring_content'> role-create --name=admin)
else
  ADMIN_ROLE=$(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_base_ks_cmd'>base_ks_cmd</span><span class='rbrace'>}</span><span class='tstring_content'> role-list | grep admin | awk '{print $2}')
fi
</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_base_ks_cmd'>base_ks_cmd</span><span class='rbrace'>}</span><span class='tstring_content'> user-list | grep </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_admin_user'>admin_user</span><span class='rbrace'>}</span><span class='tstring_content'>
if [[ $? -eq 1 ]]; then
  ADMIN_USER=$(get_id </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_base_ks_cmd'>base_ks_cmd</span><span class='rbrace'>}</span><span class='tstring_content'> user-create --name=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_admin_user'>admin_user</span><span class='rbrace'>}</span><span class='tstring_content'> --pass=&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_admin_pass'>admin_pass</span><span class='rbrace'>}</span><span class='tstring_content'>&quot; --email=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_admin_user'>admin_user</span><span class='rbrace'>}</span><span class='tstring_content'>@example.com)
else
  ADMIN_USER=$(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_base_ks_cmd'>base_ks_cmd</span><span class='rbrace'>}</span><span class='tstring_content'> user-list | grep </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_admin_user'>admin_user</span><span class='rbrace'>}</span><span class='tstring_content'> | awk '{print $2}')
fi
</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_base_ks_cmd'>base_ks_cmd</span><span class='rbrace'>}</span><span class='tstring_content'> user-role-list --user-id=$ADMIN_USER --tenant-id=$ADMIN_TENANT | grep admin
if [[ $? -eq 1 ]]; then
  </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_base_ks_cmd'>base_ks_cmd</span><span class='rbrace'>}</span><span class='tstring_content'> user-role-add --user-id $ADMIN_USER --role-id $ADMIN_ROLE --tenant-id $ADMIN_TENANT
fi
exit 0
</span><span class='heredoc_end'>EOF
</span><span class='kw'>end</span>

<span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>openstack</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>identity</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>tenants</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_tenant_name'>tenant_name</span><span class='op'>|</span>
  <span class='comment'>## Add openstack tenant ##
</span>  <span class='id identifier rubyid_openstack_identity_register'>openstack_identity_register</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Register '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_tenant_name'>tenant_name</span><span class='rbrace'>}</span><span class='tstring_content'>' Tenant</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_auth_uri'>auth_uri</span> <span class='id identifier rubyid_auth_uri'>auth_uri</span>
    <span class='id identifier rubyid_bootstrap_token'>bootstrap_token</span> <span class='id identifier rubyid_bootstrap_token'>bootstrap_token</span>
    <span class='id identifier rubyid_tenant_name'>tenant_name</span> <span class='id identifier rubyid_tenant_name'>tenant_name</span>
    <span class='id identifier rubyid_tenant_description'>tenant_description</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_tenant_name'>tenant_name</span><span class='rbrace'>}</span><span class='tstring_content'> Tenant</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_tenant_enabled'>tenant_enabled</span> <span class='kw'>true</span> <span class='comment'># Not required as this is the default
</span>
    <span class='id identifier rubyid_action'>action</span> <span class='symbol'>:create_tenant</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>openstack</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>identity</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>roles</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_role_key'>role_key</span><span class='op'>|</span>
  <span class='id identifier rubyid_openstack_identity_register'>openstack_identity_register</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Register '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_role_key'>role_key</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rbrace'>}</span><span class='tstring_content'>' Role</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_auth_uri'>auth_uri</span> <span class='id identifier rubyid_auth_uri'>auth_uri</span>
    <span class='id identifier rubyid_bootstrap_token'>bootstrap_token</span> <span class='id identifier rubyid_bootstrap_token'>bootstrap_token</span>
    <span class='id identifier rubyid_role_name'>role_name</span> <span class='id identifier rubyid_role_key'>role_key</span>

    <span class='id identifier rubyid_action'>action</span> <span class='symbol'>:create_role</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>openstack</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>identity</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>users</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_username'>username</span><span class='comma'>,</span> <span class='id identifier rubyid_user_info'>user_info</span><span class='op'>|</span>
  <span class='id identifier rubyid_openstack_identity_register'>openstack_identity_register</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Register '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_username'>username</span><span class='rbrace'>}</span><span class='tstring_content'>' User</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_auth_uri'>auth_uri</span> <span class='id identifier rubyid_auth_uri'>auth_uri</span>
    <span class='id identifier rubyid_bootstrap_token'>bootstrap_token</span> <span class='id identifier rubyid_bootstrap_token'>bootstrap_token</span>
    <span class='id identifier rubyid_user_name'>user_name</span> <span class='id identifier rubyid_username'>username</span>
    <span class='id identifier rubyid_user_pass'>user_pass</span> <span class='id identifier rubyid_user_info'>user_info</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>password</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_tenant_name'>tenant_name</span> <span class='id identifier rubyid_user_info'>user_info</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>default_tenant</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_user_enabled'>user_enabled</span> <span class='kw'>true</span> <span class='comment'># Not required as this is the default
</span>
    <span class='id identifier rubyid_action'>action</span> <span class='symbol'>:create_user</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_user_info'>user_info</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>roles</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_rolename'>rolename</span><span class='comma'>,</span> <span class='id identifier rubyid_tenant_list'>tenant_list</span><span class='op'>|</span>
    <span class='id identifier rubyid_tenant_list'>tenant_list</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_tenantname'>tenantname</span><span class='op'>|</span>
      <span class='id identifier rubyid_openstack_identity_register'>openstack_identity_register</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Grant '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_rolename'>rolename</span><span class='rbrace'>}</span><span class='tstring_content'>' Role to '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_username'>username</span><span class='rbrace'>}</span><span class='tstring_content'>' User in '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_tenantname'>tenantname</span><span class='rbrace'>}</span><span class='tstring_content'>' Tenant</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
        <span class='id identifier rubyid_auth_uri'>auth_uri</span> <span class='id identifier rubyid_auth_uri'>auth_uri</span>
        <span class='id identifier rubyid_bootstrap_token'>bootstrap_token</span> <span class='id identifier rubyid_bootstrap_token'>bootstrap_token</span>
        <span class='id identifier rubyid_user_name'>user_name</span> <span class='id identifier rubyid_username'>username</span>
        <span class='id identifier rubyid_role_name'>role_name</span> <span class='id identifier rubyid_rolename'>rolename</span>
        <span class='id identifier rubyid_tenant_name'>tenant_name</span> <span class='id identifier rubyid_tenantname'>tenantname</span>

        <span class='id identifier rubyid_action'>action</span> <span class='symbol'>:grant_role</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_openstack_identity_register'>openstack_identity_register</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Register Identity Service</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_auth_uri'>auth_uri</span> <span class='id identifier rubyid_auth_uri'>auth_uri</span>
  <span class='id identifier rubyid_bootstrap_token'>bootstrap_token</span> <span class='id identifier rubyid_bootstrap_token'>bootstrap_token</span>
  <span class='id identifier rubyid_service_name'>service_name</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>keystone</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_service_type'>service_type</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>identity</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_service_description'>service_description</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Keystone Identity Service</span><span class='tstring_end'>&quot;</span></span>

  <span class='id identifier rubyid_action'>action</span> <span class='symbol'>:create_service</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_node'>node</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>openstack</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>identity</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>adminURL</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_identity_admin_endpoint'>identity_admin_endpoint</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
<span class='id identifier rubyid_node'>node</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>openstack</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>identity</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>internalURL</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_identity_endpoint'>identity_endpoint</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
<span class='id identifier rubyid_node'>node</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>openstack</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>identity</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>publicURL</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_identity_endpoint'>identity_endpoint</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>

<span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Keystone AdminURL: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_identity_admin_endpoint'>identity_admin_endpoint</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Keystone InternalURL: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_identity_endpoint'>identity_endpoint</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Keystone PublicURL: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_identity_endpoint'>identity_endpoint</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_openstack_identity_register'>openstack_identity_register</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Register Identity Endpoint</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_auth_uri'>auth_uri</span> <span class='id identifier rubyid_auth_uri'>auth_uri</span>
  <span class='id identifier rubyid_bootstrap_token'>bootstrap_token</span> <span class='id identifier rubyid_bootstrap_token'>bootstrap_token</span>
  <span class='id identifier rubyid_service_type'>service_type</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>identity</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_endpoint_region'>endpoint_region</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>openstack</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>identity</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>region</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_endpoint_adminurl'>endpoint_adminurl</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>openstack</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>identity</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>adminURL</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_endpoint_internalurl'>endpoint_internalurl</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>openstack</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>identity</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>adminURL</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_endpoint_publicurl'>endpoint_publicurl</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>openstack</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>identity</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>publicURL</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>

  <span class='id identifier rubyid_action'>action</span> <span class='symbol'>:create_endpoint</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>openstack</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>identity</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>users</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_username'>username</span><span class='comma'>,</span> <span class='id identifier rubyid_user_info'>user_info</span><span class='op'>|</span>
  <span class='id identifier rubyid_openstack_identity_register'>openstack_identity_register</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Create EC2 credentials for '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_username'>username</span><span class='rbrace'>}</span><span class='tstring_content'>' user</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_auth_uri'>auth_uri</span> <span class='id identifier rubyid_auth_uri'>auth_uri</span>
    <span class='id identifier rubyid_bootstrap_token'>bootstrap_token</span> <span class='id identifier rubyid_bootstrap_token'>bootstrap_token</span>
    <span class='id identifier rubyid_user_name'>user_name</span> <span class='id identifier rubyid_username'>username</span>
    <span class='id identifier rubyid_tenant_name'>tenant_name</span> <span class='id identifier rubyid_user_info'>user_info</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>default_tenant</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>

    <span class='id identifier rubyid_action'>action</span> <span class='symbol'>:create_ec2_credentials</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>

    </div>
  




  <h2>Action Details</h2>
  
    
    
      
        <div class="method_details first">
          <h3 class="signature"><a name="create_service">
            <strong>create_service</strong>
            &nbsp;(Chef::Provider::IdentityRegister)
          </a></h3>
          
          

<table class="source_code">
  <tr>
    <td>
      <pre class="lines">


65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'providers/register.rb', line 65</span>

<span class='id identifier rubyid_action'>action</span> <span class='symbol'>:create_service</span> <span class='kw'>do</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>openstack</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>identity</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>catalog</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>backend</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>templated</span><span class='tstring_end'>&quot;</span></span>
    <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Skipping service creation - templated catalog backend in use.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_updated_by_last_action'>updated_by_last_action</span><span class='lparen'>(</span><span class='kw'>false</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_service_uuid'>service_uuid</span> <span class='op'>=</span> <span class='id identifier rubyid_identity_uuid'>identity_uuid</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>service</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>type</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_service_type'>service_type</span>

      <span class='kw'>unless</span> <span class='id identifier rubyid_service_uuid'>service_uuid</span>
        <span class='id identifier rubyid_identity_command'>identity_command</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>service-create</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
          <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>type</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_service_type'>service_type</span><span class='comma'>,</span>
            <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>name</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_service_name'>service_name</span><span class='comma'>,</span>
            <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>description</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_service_description'>service_description</span> <span class='rbrace'>}</span>
        <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Created service '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_service_name'>service_name</span><span class='rbrace'>}</span><span class='tstring_content'>'</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_updated_by_last_action'>updated_by_last_action</span><span class='lparen'>(</span><span class='kw'>true</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Service Type '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_service_type'>service_type</span><span class='rbrace'>}</span><span class='tstring_content'>' already exists.. Not creating.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Service UUID: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_service_uuid'>service_uuid</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_updated_by_last_action'>updated_by_last_action</span><span class='lparen'>(</span><span class='kw'>false</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
      <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unable to create service '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_service_name'>service_name</span><span class='rbrace'>}</span><span class='tstring_content'>'</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Error was: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_updated_by_last_action'>updated_by_last_action</span><span class='lparen'>(</span><span class='kw'>false</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>

        </div>
      
        <div class="method_details ">
          <h3 class="signature"><a name="create_endpoint">
            <strong>create_endpoint</strong>
            &nbsp;(Chef::Provider::IdentityRegister)
          </a></h3>
          
          

<table class="source_code">
  <tr>
    <td>
      <pre class="lines">


93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'providers/register.rb', line 93</span>

<span class='id identifier rubyid_action'>action</span> <span class='symbol'>:create_endpoint</span> <span class='kw'>do</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>openstack</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>identity</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>catalog</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>backend</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>templated</span><span class='tstring_end'>&quot;</span></span>
    <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Skipping endpoint creation - templated catalog backend in use.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_updated_by_last_action'>updated_by_last_action</span><span class='lparen'>(</span><span class='kw'>false</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_service_uuid'>service_uuid</span> <span class='op'>=</span> <span class='id identifier rubyid_identity_uuid'>identity_uuid</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>service</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>type</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_service_type'>service_type</span>
      <span class='kw'>unless</span> <span class='id identifier rubyid_service_uuid'>service_uuid</span>
        <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unable to find service type '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_service_type'>service_type</span><span class='rbrace'>}</span><span class='tstring_content'>'</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_updated_by_last_action'>updated_by_last_action</span><span class='lparen'>(</span><span class='kw'>false</span><span class='rparen'>)</span>
        <span class='kw'>next</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_endpoint_uuid'>endpoint_uuid</span> <span class='op'>=</span> <span class='id identifier rubyid_identity_uuid'>identity_uuid</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>endpoint</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>service_id</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_service_uuid'>service_uuid</span>
      <span class='kw'>unless</span> <span class='id identifier rubyid_endpoint_uuid'>endpoint_uuid</span>
        <span class='id identifier rubyid_identity_command'>identity_command</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>endpoint-create</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
          <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>region</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_endpoint_region'>endpoint_region</span><span class='comma'>,</span>
            <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>service_id</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_service_uuid'>service_uuid</span><span class='comma'>,</span>
            <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>publicurl</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_endpoint_publicurl'>endpoint_publicurl</span><span class='comma'>,</span>
            <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>internalurl</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_endpoint_internalurl'>endpoint_internalurl</span><span class='comma'>,</span>
            <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>adminurl</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_endpoint_adminurl'>endpoint_adminurl</span> <span class='rbrace'>}</span>
        <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Created endpoint for service type '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_service_type'>service_type</span><span class='rbrace'>}</span><span class='tstring_content'>'</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_updated_by_last_action'>updated_by_last_action</span><span class='lparen'>(</span><span class='kw'>true</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Endpoint already exists for Service Type '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_service_type'>service_type</span><span class='rbrace'>}</span><span class='tstring_content'>' already exists.. Not creating.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_updated_by_last_action'>updated_by_last_action</span><span class='lparen'>(</span><span class='kw'>false</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
      <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unable to create endpoint for service type '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_service_type'>service_type</span><span class='rbrace'>}</span><span class='tstring_content'>'</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Error was: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_updated_by_last_action'>updated_by_last_action</span><span class='lparen'>(</span><span class='kw'>false</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>

        </div>
      
        <div class="method_details ">
          <h3 class="signature"><a name="create_tenant">
            <strong>create_tenant</strong>
            &nbsp;(Chef::Provider::IdentityRegister)
          </a></h3>
          
          

<table class="source_code">
  <tr>
    <td>
      <pre class="lines">


128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'providers/register.rb', line 128</span>

<span class='id identifier rubyid_action'>action</span> <span class='symbol'>:create_tenant</span> <span class='kw'>do</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_tenant_uuid'>tenant_uuid</span> <span class='op'>=</span> <span class='id identifier rubyid_identity_uuid'>identity_uuid</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>tenant</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_tenant_name'>tenant_name</span>

    <span class='kw'>unless</span> <span class='id identifier rubyid_tenant_uuid'>tenant_uuid</span>
      <span class='id identifier rubyid_identity_command'>identity_command</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>tenant-create</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
        <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>name</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_tenant_name'>tenant_name</span><span class='comma'>,</span>
          <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>description</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_tenant_description'>tenant_description</span><span class='comma'>,</span>
          <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>enabled</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_tenant_enabled'>tenant_enabled</span> <span class='rbrace'>}</span>
      <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Created tenant '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_tenant_name'>tenant_name</span><span class='rbrace'>}</span><span class='tstring_content'>'</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_updated_by_last_action'>updated_by_last_action</span><span class='lparen'>(</span><span class='kw'>true</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Tenant '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_tenant_name'>tenant_name</span><span class='rbrace'>}</span><span class='tstring_content'>' already exists.. Not creating.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Tenant UUID: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_tenant_uuid'>tenant_uuid</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_tenant_uuid'>tenant_uuid</span>
      <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_updated_by_last_action'>updated_by_last_action</span><span class='lparen'>(</span><span class='kw'>false</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unable to create tenant '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_tenant_name'>tenant_name</span><span class='rbrace'>}</span><span class='tstring_content'>'</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Error was: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_updated_by_last_action'>updated_by_last_action</span><span class='lparen'>(</span><span class='kw'>false</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>

        </div>
      
        <div class="method_details ">
          <h3 class="signature"><a name="create_role">
            <strong>create_role</strong>
            &nbsp;(Chef::Provider::IdentityRegister)
          </a></h3>
          
          

<table class="source_code">
  <tr>
    <td>
      <pre class="lines">


151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'providers/register.rb', line 151</span>

<span class='id identifier rubyid_action'>action</span> <span class='symbol'>:create_role</span> <span class='kw'>do</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_role_uuid'>role_uuid</span> <span class='op'>=</span> <span class='id identifier rubyid_identity_uuid'>identity_uuid</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>role</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_role_name'>role_name</span>

    <span class='kw'>unless</span> <span class='id identifier rubyid_role_uuid'>role_uuid</span>
      <span class='id identifier rubyid_identity_command'>identity_command</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>role-create</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
        <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>name</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_role_name'>role_name</span> <span class='rbrace'>}</span>
      <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Created Role '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_role_name'>role_name</span><span class='rbrace'>}</span><span class='tstring_content'>'</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_updated_by_last_action'>updated_by_last_action</span><span class='lparen'>(</span><span class='kw'>true</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Role '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_role_name'>role_name</span><span class='rbrace'>}</span><span class='tstring_content'>' already exists.. Not creating.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Role UUID: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_role_uuid'>role_uuid</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_updated_by_last_action'>updated_by_last_action</span><span class='lparen'>(</span><span class='kw'>false</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unable to create role '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_role_name'>role_name</span><span class='rbrace'>}</span><span class='tstring_content'>'</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Error was: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_updated_by_last_action'>updated_by_last_action</span><span class='lparen'>(</span><span class='kw'>false</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>

        </div>
      
        <div class="method_details ">
          <h3 class="signature"><a name="create_user">
            <strong>create_user</strong>
            &nbsp;(Chef::Provider::IdentityRegister)
          </a></h3>
          
          

<table class="source_code">
  <tr>
    <td>
      <pre class="lines">


172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'providers/register.rb', line 172</span>

<span class='id identifier rubyid_action'>action</span> <span class='symbol'>:create_user</span> <span class='kw'>do</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_tenant_uuid'>tenant_uuid</span> <span class='op'>=</span> <span class='id identifier rubyid_identity_uuid'>identity_uuid</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>tenant</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_tenant_name'>tenant_name</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_tenant_uuid'>tenant_uuid</span>
      <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unable to find tenant '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_tenant_name'>tenant_name</span><span class='rbrace'>}</span><span class='tstring_content'>'</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_updated_by_last_action'>updated_by_last_action</span><span class='lparen'>(</span><span class='kw'>false</span><span class='rparen'>)</span>
      <span class='kw'>next</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_output'>output</span> <span class='op'>=</span> <span class='id identifier rubyid_identity_command'>identity_command</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user-list</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>tenant-id</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_tenant_uuid'>tenant_uuid</span><span class='rbrace'>}</span>
    <span class='id identifier rubyid_users'>users</span> <span class='op'>=</span> <span class='id identifier rubyid_prettytable_to_array'>prettytable_to_array</span> <span class='id identifier rubyid_output'>output</span>
    <span class='id identifier rubyid_user_found'>user_found</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='id identifier rubyid_users'>users</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_user'>user</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_user'>user</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>name</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_user_name'>user_name</span>
        <span class='id identifier rubyid_user_found'>user_found</span> <span class='op'>=</span> <span class='kw'>true</span>
      <span class='kw'>end</span>
    <span class='rbrace'>}</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_user_found'>user_found</span>
      <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>User '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_user_name'>user_name</span><span class='rbrace'>}</span><span class='tstring_content'>' already exists for tenant '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_tenant_name'>tenant_name</span><span class='rbrace'>}</span><span class='tstring_content'>'</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_updated_by_last_action'>updated_by_last_action</span><span class='lparen'>(</span><span class='kw'>false</span><span class='rparen'>)</span>
      <span class='kw'>next</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_identity_command'>identity_command</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user-create</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
      <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>name</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_user_name'>user_name</span><span class='comma'>,</span>
        <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>tenant-id</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_tenant_uuid'>tenant_uuid</span><span class='comma'>,</span>
        <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>pass</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_user_pass'>user_pass</span><span class='comma'>,</span>
        <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>enabled</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_user_enabled'>user_enabled</span> <span class='rbrace'>}</span>
    <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Created user '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_user_name'>user_name</span><span class='rbrace'>}</span><span class='tstring_content'>' for tenant '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_tenant_name'>tenant_name</span><span class='rbrace'>}</span><span class='tstring_content'>'</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_updated_by_last_action'>updated_by_last_action</span><span class='lparen'>(</span><span class='kw'>true</span><span class='rparen'>)</span>
  <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unable to create user '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_user_name'>user_name</span><span class='rbrace'>}</span><span class='tstring_content'>' for tenant '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_tenant_name'>tenant_name</span><span class='rbrace'>}</span><span class='tstring_content'>'</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Error was: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_updated_by_last_action'>updated_by_last_action</span><span class='lparen'>(</span><span class='kw'>false</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>

        </div>
      
        <div class="method_details ">
          <h3 class="signature"><a name="grant_role">
            <strong>grant_role</strong>
            &nbsp;(Chef::Provider::IdentityRegister)
          </a></h3>
          
          

<table class="source_code">
  <tr>
    <td>
      <pre class="lines">


210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'providers/register.rb', line 210</span>

<span class='id identifier rubyid_action'>action</span> <span class='symbol'>:grant_role</span> <span class='kw'>do</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_tenant_uuid'>tenant_uuid</span> <span class='op'>=</span> <span class='id identifier rubyid_identity_uuid'>identity_uuid</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>tenant</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_tenant_name'>tenant_name</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_tenant_uuid'>tenant_uuid</span>
      <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unable to find tenant '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_tenant_name'>tenant_name</span><span class='rbrace'>}</span><span class='tstring_content'>'</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_updated_by_last_action'>updated_by_last_action</span><span class='lparen'>(</span><span class='kw'>false</span><span class='rparen'>)</span>
      <span class='kw'>next</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_user_uuid'>user_uuid</span> <span class='op'>=</span> <span class='id identifier rubyid_identity_uuid'>identity_uuid</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_user_name'>user_name</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_tenant_uuid'>tenant_uuid</span>
      <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unable to find user '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_user_name'>user_name</span><span class='rbrace'>}</span><span class='tstring_content'>'</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_updated_by_last_action'>updated_by_last_action</span><span class='lparen'>(</span><span class='kw'>false</span><span class='rparen'>)</span>
      <span class='kw'>next</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_role_uuid'>role_uuid</span> <span class='op'>=</span> <span class='id identifier rubyid_identity_uuid'>identity_uuid</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>role</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_role_name'>role_name</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_tenant_uuid'>tenant_uuid</span>
      <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unable to find role '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_role_name'>role_name</span><span class='rbrace'>}</span><span class='tstring_content'>'</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_updated_by_last_action'>updated_by_last_action</span><span class='lparen'>(</span><span class='kw'>false</span><span class='rparen'>)</span>
      <span class='kw'>next</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_assigned_role_uuid'>assigned_role_uuid</span> <span class='op'>=</span> <span class='id identifier rubyid_identity_uuid'>identity_uuid</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user-role</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_role_name'>role_name</span><span class='comma'>,</span>
      <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>tenant-id</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_tenant_uuid'>tenant_uuid</span><span class='comma'>,</span>
        <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>user-id</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_user_uuid'>user_uuid</span> <span class='rbrace'>}</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_role_uuid'>role_uuid</span> <span class='op'>==</span> <span class='id identifier rubyid_assigned_role_uuid'>assigned_role_uuid</span>
      <span class='id identifier rubyid_identity_command'>identity_command</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user-role-add</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
        <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>tenant-id</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_tenant_uuid'>tenant_uuid</span><span class='comma'>,</span>
          <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>role-id</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_role_uuid'>role_uuid</span><span class='comma'>,</span>
          <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>user-id</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_user_uuid'>user_uuid</span> <span class='rbrace'>}</span>
      <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Granted Role '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_role_name'>role_name</span><span class='rbrace'>}</span><span class='tstring_content'>' to User '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_user_name'>user_name</span><span class='rbrace'>}</span><span class='tstring_content'>' in Tenant '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_tenant_name'>tenant_name</span><span class='rbrace'>}</span><span class='tstring_content'>'</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_updated_by_last_action'>updated_by_last_action</span><span class='lparen'>(</span><span class='kw'>true</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Role '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_role_name'>role_name</span><span class='rbrace'>}</span><span class='tstring_content'>' already granted to User '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_user_name'>user_name</span><span class='rbrace'>}</span><span class='tstring_content'>' in Tenant '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_tenant_name'>tenant_name</span><span class='rbrace'>}</span><span class='tstring_content'>'</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_updated_by_last_action'>updated_by_last_action</span><span class='lparen'>(</span><span class='kw'>false</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unable to grant role '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_role_name'>role_name</span><span class='rbrace'>}</span><span class='tstring_content'>' to user '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_user_name'>user_name</span><span class='rbrace'>}</span><span class='tstring_content'>'</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Error was: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_updated_by_last_action'>updated_by_last_action</span><span class='lparen'>(</span><span class='kw'>false</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>

        </div>
      
        <div class="method_details ">
          <h3 class="signature"><a name="create_ec2_credentials">
            <strong>create_ec2_credentials</strong>
            &nbsp;(Chef::Provider::IdentityRegister)
          </a></h3>
          
          

<table class="source_code">
  <tr>
    <td>
      <pre class="lines">


254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'providers/register.rb', line 254</span>

<span class='id identifier rubyid_action'>action</span> <span class='symbol'>:create_ec2_credentials</span> <span class='kw'>do</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_tenant_uuid'>tenant_uuid</span> <span class='op'>=</span> <span class='id identifier rubyid_identity_uuid'>identity_uuid</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>tenant</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_tenant_name'>tenant_name</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_tenant_uuid'>tenant_uuid</span>
      <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unable to find tenant '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_tenant_name'>tenant_name</span><span class='rbrace'>}</span><span class='tstring_content'>'</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_updated_by_last_action'>updated_by_last_action</span><span class='lparen'>(</span><span class='kw'>false</span><span class='rparen'>)</span>
      <span class='kw'>next</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_user_uuid'>user_uuid</span> <span class='op'>=</span> <span class='id identifier rubyid_identity_uuid'>identity_uuid</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_user_name'>user_name</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>tenant-id</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_tenant_uuid'>tenant_uuid</span><span class='rbrace'>}</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_tenant_uuid'>tenant_uuid</span>
      <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unable to find user '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_user_name'>user_name</span><span class='rbrace'>}</span><span class='tstring_content'>'</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_updated_by_last_action'>updated_by_last_action</span><span class='lparen'>(</span><span class='kw'>false</span><span class='rparen'>)</span>
      <span class='kw'>next</span>
    <span class='kw'>end</span>

    <span class='comment'># this is not really a uuid, but this will work nonetheless
</span>    <span class='id identifier rubyid_access'>access</span> <span class='op'>=</span> <span class='id identifier rubyid_identity_uuid'>identity_uuid</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ec2-credentials</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>tenant</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_tenant_name'>tenant_name</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>user-id</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_user_uuid'>user_uuid</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>access</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_access'>access</span>
     <span class='id identifier rubyid_output'>output</span> <span class='op'>=</span> <span class='id identifier rubyid_identity_command'>identity_command</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ec2-credentials-create</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
        <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>user-id</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_user_uuid'>user_uuid</span><span class='comma'>,</span>
          <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>tenant-id</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_tenant_uuid'>tenant_uuid</span> <span class='rbrace'>}</span>
      <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Created EC2 Credentials for User '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_user_name'>user_name</span><span class='rbrace'>}</span><span class='tstring_content'>' in Tenant '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_tenant_name'>tenant_name</span><span class='rbrace'>}</span><span class='tstring_content'>'</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_prettytable_to_array'>prettytable_to_array</span><span class='lparen'>(</span><span class='id identifier rubyid_output'>output</span><span class='rparen'>)</span>

      <span class='kw'>if</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>!=</span> <span class='int'>1</span>
        <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Got bad data when creating ec2 credentials for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_user_name'>user_name</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Data: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_data'>data</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='comment'># Update node attributes
</span>        <span class='id identifier rubyid_node'>node</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>credentials</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>EC2</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_user_name'>user_name</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>access</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>access</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_node'>node</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>credentials</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>EC2</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_user_name'>user_name</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>secret</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>secret</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_node'>node</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span> <span class='kw'>unless</span> <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Config</span><span class='lbracket'>[</span><span class='symbol'>:solo</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_updated_by_last_action'>updated_by_last_action</span><span class='lparen'>(</span><span class='kw'>true</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>EC2 credentials already exist for '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_user_name'>user_name</span><span class='rbrace'>}</span><span class='tstring_content'>' in tenant '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_tenant_name'>tenant_name</span><span class='rbrace'>}</span><span class='tstring_content'>'</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_updated_by_last_action'>updated_by_last_action</span><span class='lparen'>(</span><span class='kw'>false</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unable to create EC2 Credentials for User '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_user_name'>user_name</span><span class='rbrace'>}</span><span class='tstring_content'>' in Tenant '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_tenant_name'>tenant_name</span><span class='rbrace'>}</span><span class='tstring_content'>'</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Error was: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_updated_by_last_action'>updated_by_last_action</span><span class='lparen'>(</span><span class='kw'>false</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>

        </div>
      
    
  






</div>


</div>
</div>

    <div id="footer">
  Generated on Tue Aug 20 15:56:09 2013 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7 (ruby-1.9.3).
</div>

  </body>
</html>